/*********************************************************************************************************//**
* @file adc_drv.c
* @author 
*  JangHo,Yoo
* @date 2012.10.30 
* @brief 
*  Source file of ADC(AD7904) and ADC(CPU Core) device drvier
*  1. CoreADC Enable or Disable
*  2. AD7904 Interface
*  3. CoreADC converion result 
*  4. AD7904 conversion result 
*************************************************************************************************************/

/*************************************************************************************************************
* INCLUDE FILES
*************************************************************************************************************/
#include "kernel.h"
#include "adc_drv.h"

/*************************************************************************************************************
* LOCAL DEFINES
*************************************************************************************************************/
#define USE_ADC_IRQ                                       0

#define CORE_ADC_CHANNEL_MAX                              8     //8ch Core ADC

#define CORE_ADC_TIME_OUT                                 0x00FFFFFF

/*************************************************************************************************************
* LOCAL CONSTANTS
*************************************************************************************************************/
//AD7904 SPI Communication Macro //YMCA
/*
#define AD7904_CS_LOW()		GpioSetLo(GPIO_ADC_CS)
#define AD7904_CS_HIGH()	GpioSetHi(GPIO_ADC_CS)
#define AD7904_SCK_LOW()	GpioSetLo(GPIO_ADC_SCK)
#define AD7904_SCK_HIGH()	GpioSetHi(GPIO_ADC_SCK)
#define AD7904_SDO_LOW()	GpioSetLo(GPIO_ADC_SO)
#define AD7904_SDO_HIGH()	GpioSetHi(GPIO_ADC_SO)
#define AD7904_SDI_PIN()	GpioGetPin(GPIO_ADC_SI)
*/ //YMCA
/*************************************************************************************************************
* LOCAL DATA TYPES
*************************************************************************************************************/

/*************************************************************************************************************
* LOCAL TABLES
*************************************************************************************************************/

/*************************************************************************************************************
* LOCAL GLOBAL VARIABLES
*************************************************************************************************************/

/*************************************************************************************************************
* LOCAL FUNCTION PROTOTYPES
*************************************************************************************************************/

/*************************************************************************************************************
* LOCAL CONFIGURATION ERRORS
*************************************************************************************************************/

/*************************************************************************************************************
**************************************************************************************************************
* LOCAL FUNCTIONS
**************************************************************************************************************
*************************************************************************************************************/



/*************************************************************************************************************
**************************************************************************************************************
* GLOBAL FUNCTIONS
**************************************************************************************************************
*************************************************************************************************************/
#if 0 //121030-YJH : Further use
/*********************************************************************************************************//**
* @param[in] none
* @param[out] none
* @retval none
* @brief 
*  Init AD79X4 ADC Device driver
*************************************************************************************************************/
void AD79X4_InitDriver(uint16 ctrl_reg)
{
	
} /* AD79X4_InitDriver */
#endif




/*********************************************************************************************************//**
* @param[in] none
* @param[out] none
* @retval none
* @brief 
*  AD7904 Device driver //YMCA
*************************************************************************************************************/
/* //YMCA
uint16 AD7904(uint16 data)
{
	uint32 Ad7904Val = 0;
	uint16	ad_data = 0;
	uint08 i;

	Ad7904Val = data;


	AD7904_CS_LOW();                  

	for (i = 0; i < 16; i++) 
	{                      
		AD7904_SCK_HIGH();                    

		if (Ad7904Val & 0x8000) 
		{
			AD7904_SDO_HIGH();
		} else 
		{
			AD7904_SDO_LOW();
		}

		AD7904_SCK_LOW();

		if (AD7904_SDI_PIN() & 0x1)
		{
			ad_data |= (1 << (15 - i));
		}
		Ad7904Val <<= 1;
	}
	
	AD7904_SCK_HIGH();                            
	AD7904_SDO_HIGH();
	AD7904_CS_HIGH();                           

	ad_data = ad_data >> 5;
	ad_data &= 0xFF;

	return ad_data;
	
}
*/ //YMCA
/*********************************************************************************************************//**
* @param[in] none
* @param[out] none
* @retval none
* @brief 
*  Init Core ADC Device driver
*************************************************************************************************************/
void InitCoreAdcDriver(void)
{
#if USE_KERNEL_DEBUG > 0
//	DebugPrintf("Core ADC Driver Initialize...\n\r");  //YMCA
#endif
	ADC_EN_EN773Aw(0);  // 3
	ADC_INT_EN_EN773Aw(0); // 2  //$ YMCA
	ADC_MODE_EN773Aw(0); //5	
	ADC_SRATE_EN773Aw(0x10); // 6 //$ YMCA	

} /* InitAdcCoreDriver */

/*********************************************************************************************************//**
* @param[in] adc_ch : ADC channel
*            CORE_ADC_CH0 : ADCI0 channel
*            CORE_ADC_CH1 : ADCI1 channel
*            CORE_ADC_CH2 : ADCI2 channel
*            CORE_ADC_CH3 : ADCI3 channel
*            CORE_ADC_CH4 : -
*            CORE_ADC_CH5 : -
*            CORE_ADC_CH6 : -
*            CORE_ADC_CH7 : -
* @param[out] none
* @retval 
*  Core ADC conversion result.
* @brief 
*  Get CoreADC conversion result from core ADC.
*************************************************************************************************************/
uint16 CPU_MEM_ISPM GetCoreAdcResult(CORE_ADC_CH_N adc_ch)
{
	uint16 adc_val = 0;

	switch(adc_ch)
	{
		case CORE_ADC_CH0:
			adc_val = ADC0_RDAT_EN773Ar;  //F_END
			break;
		case CORE_ADC_CH1:
			adc_val = ADC1_RDAT_EN773Ar;  //Z_END 
			break;
		case CORE_ADC_CH2:
			adc_val = ADC2_RDAT_EN773Ar;  //CDS/EXT  
			break;
		case CORE_ADC_CH3:
			adc_val = ADC3_RDAT_EN773Ar;  //KEY1 
			break;
		default:
			adc_val = 0xFFFF;
	}

	return (adc_val);
} /* CoreAdcStart */

/*********************************************************************************************************//**
* @param[in] none
* @param[out] none
* @retval none
* @brief 
*  ADC conversion complete Interrupt Service Routine
* @attention
*  Call by exception handler. check your vector table.
*************************************************************************************************************/
#pragma interrupt
void CPU_MEM_ISPM CoreAdcIsr(void)
{
	IRQ_CLR(IRQ_ADC);
#if 0
	//TODO : Add your interrupt service code
	CoreAdcBusyFlag = FALSE;

	ADCCTRL_ADSTCw(STC_NO);
#endif	
} /* AdcIsr */
/********************************************** END OF FILE *************************************************/





